<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenCyto: How to use different auto gating functions • openCyto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="OpenCyto: How to use different auto gating functions">
<meta property="og:description" content="openCyto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openCyto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.99.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HowToAutoGating.html">OpenCyto: How to use different auto gating functions</a>
    </li>
    <li>
      <a href="../articles/HowToWriteCSVTemplate.html">How to write a csv gating template</a>
    </li>
    <li>
      <a href="../articles/openCytoVignette.html">An Introduction to the openCyto package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>OpenCyto: How to use different auto gating functions</h1>
                        <h4 class="author">Mike Jiang</h4>
            
      
      
      <div class="hidden name"><code>HowToAutoGating.Rmd</code></div>

    </div>

    
    
<p>Here we will illustrate how to choose and use the appropriate gating methods that are pre-registered in <code>openCyto</code> package. And users can always define their own <code>gating</code> algorithms and register them as the <code>plugin</code> functions in <code>openCyto</code> framework, see <code><a href="../reference/register_plugins.html">?registerPlugins</a></code> for more details.</p>
<p>Note that all the function names illustrated below are prefixed with <code>.</code> indicating that they are simply the wrapper function registered in <code>openCyto</code>. The actual <code>gating engine</code> behind the wrapper can come from other packages (e.g. <code>flowCore</code>, <code>flowClust</code>). All these wrappers have these common interfaces: * <code>fr</code>: a <code>flowFrame</code> object * <code>pp_res</code>: an optional <code>pre-preocessing</code> result, which can be ignored in this document * <code>channels</code>: channel names used for gating * <code>...</code>: any other gating parameters pass on to the actual gating engine</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flowCore</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flowWorkspace</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openCyto</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggcyto</span>)

<span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/save_gs.html">load_gs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/gs_bcell_auto"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"flowWorkspaceData"</span>))</pre></body></html></div>
<div id="d-gating-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#d-gating-methods" class="anchor"></a>1D gating methods</h2>
<div id="mindensity" class="section level3">
<h3 class="hasAnchor">
<a href="#mindensity" class="anchor"></a><code>mindensity</code>
</h3>
<p>The name of this gating function is self-explaining, that is to find the minimum as the cutpoint between negative and postive peaks in 1d density plot. It is fast,robust and extremely easy to use especially when there is a good separation between <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> and <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> populations/peaks.</p>
<p>For example, it is usually easy to gate on <code>CD3</code> channel and no need to supply any arguments to the method.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">2</span>]], <span class="st">"Live"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="st">"CD3"</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.mindensity</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>, <span class="st">"SSC-A"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-3-1.png" width="288"><img src="HowToAutoGating_files/figure-html/unnamed-chunk-3-2.png" width="288"></p>
<p>However, it may need some guidance when there are more than <code>2</code> major peaks/populations detected in densit profile.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"boundary"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="st">"FSC-A"</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.mindensity</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>)
<span class="no">mylimits</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto_par_set.html">ggcyto_par_set</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="st">"instrument"</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>) + <span class="no">mylimits</span>
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>, <span class="st">"SSC-A"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-4-1.png" width="288"><img src="HowToAutoGating_files/figure-html/unnamed-chunk-4-2.png" width="288"></p>
<p>Here we actually want to remove the <code>debris cells</code> that are represented by the first negative peak. But <code>mindensity</code> cuts between the second and third peaks since they are more predorminant. So we can simply specify a <code>range</code> that will limit the locations where the cut point should be placed.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.mindensity</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">gate_range</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7e4</span>,<span class="fl">1e5</span>), <span class="kw">adjust</span> <span class="kw">=</span> <span class="fl">1.5</span>)
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>, <span class="st">"SSC-A"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-5-1.png" width="288"><img src="HowToAutoGating_files/figure-html/unnamed-chunk-5-2.png" width="288"></p>
<p>And as shown, we also changed the <code>kernal density</code> smoothing factor <code>adjust</code> from <code>2</code>(default value set in <code>openCtyo</code>) to <code>1.5</code> to avoid over-smoothing.</p>
<p>Alternatively you can achieve the same effect by setting <code>min</code> or <code>max</code> to pre-filter the data before the <code>mindenstiy</code> works on it.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.mindensity</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">min</span> <span class="kw">=</span> <span class="fl">7e4</span>, <span class="kw">max</span> <span class="kw">=</span> <span class="fl">1e5</span>)
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-6-1.png" width="288"></p>
<p>To choose one way or the other or combining both is highly dependent on how your data. The more contrains will give you more controls on how gating proceeds yet at cost of robustness of your gating pipeline sometime.</p>
</div>
<div id="tailgate" class="section level3">
<h3 class="hasAnchor">
<a href="#tailgate" class="anchor"></a><code>tailgate</code>
</h3>
<p>This gating method is used in the senarios where there is only one major peak detected thus automatically disqualify the usage of <code>mindensity</code>. <code>tol</code> is to control how far the cut point should be placed away from the peak.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"lymph"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="st">"Live"</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.tailgate</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">tol</span> <span class="kw">=</span> <span class="fl">0.05</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>) + <span class="no">mylimits</span>
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>, <span class="st">"SSC-A"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-7-1.png" width="288"><img src="HowToAutoGating_files/figure-html/unnamed-chunk-7-2.png" width="288"></p>
</div>
<div id="quantilegate" class="section level3">
<h3 class="hasAnchor">
<a href="#quantilegate" class="anchor"></a><code>quantileGate</code>
</h3>
<p>This method is an alternative to <code>tailgate</code> and it determines the cutpoint by the events quantile.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.quantileGate</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">probs</span> <span class="kw">=</span> <span class="fl">0.99</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>) + <span class="no">mylimits</span>
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>, <span class="st">"SSC-A"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-8-1.png" width="288"><img src="HowToAutoGating_files/figure-html/unnamed-chunk-8-2.png" width="288"></p>
<p>This gating method is more commonly used in gating the <code>rare</code> populations when the target population is not prominent enough to stand out as the second peak. (e.g. <code>cytokine</code> gates in <code>ICS</code> assays.)</p>
</div>
</div>
<div id="d-gating-methods-1" class="section level2">
<h2 class="hasAnchor">
<a href="#d-gating-methods-1" class="anchor"></a>2D gating methods</h2>
<div id="boundary-gate" class="section level3">
<h3 class="hasAnchor">
<a href="#boundary-gate" class="anchor"></a><code>boundary Gate</code>
</h3>
<p>It essentially constructs a rectangle gate from input range (min, max), which is useful for filtering out very extreme signals at the bounary.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"root"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"FSC-A"</span>, <span class="st">"SSC-A"</span>)
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.boundary</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">min</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>), <span class="kw">max</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.5e5</span>,<span class="fl">2.5e5</span>))
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">2</span>])
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-9-1.png" width="288"></p>
</div>
<div id="singletgate" class="section level3">
<h3 class="hasAnchor">
<a href="#singletgate" class="anchor"></a><code>singletGate</code>
</h3>
<p>Use the <code>area</code> vs <code>height</code> to gate out the singlets. See details from <code>?singletGate</code>.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/read.FCS.html">read.FCS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/CytoTrol_CytoTrol_1.fcs"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"flowWorkspaceData"</span>))
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"FSC-A"</span>, <span class="st">"FSC-H"</span>)
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.singletGate</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">2</span>])
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-10-1.png" width="288"></p>
</div>
<div id="flowclust-2d" class="section level3">
<h3 class="hasAnchor">
<a href="#flowclust-2d" class="anchor"></a><code>flowClust.2d</code>
</h3>
<p><code>flowClust</code> package in itself is not limited to 2-dimensional gating. But here we are talking about a dedicated wrapper function <code>.flowClust.2d</code> from <code>openCyto</code> package that leverages <code>flowClust</code> clustering engine to work on <code>2D</code> cases specifically. You won’t need to write the full name of the function in <code>csv</code> gating template, simply put <code>flowClust</code> in the <code>gating_method</code> column, and then the template parser will automatically dispatch to the right function.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"nonDebris"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"FSC-A"</span>, <span class="st">"SSC-A"</span>)
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.flowClust.2d</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">K</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">target</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1e5</span>,<span class="fl">5e4</span>), <span class="kw">quantile</span><span class="kw">=</span><span class="fl">0.95</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">2</span>]) + <span class="no">mylimits</span>
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-11-1.png" width="288"></p>
<p><code>K</code> is to tell the algorithm how many major clusters/populations are expected in the 2d profile. <code>target</code> specify the mean/center of the target population to get, which doesn’t have to be precise. If not supplied, flowClust will pick the most prominent cluster as the target, which would be the right choice in most cases. <code>quantile</code> specify how large the <code>ellipse</code> should be. <code>pp_res</code> is used to provide the <code>prior</code> information for <code>flowClust</code>. (More details are in <code>?flowClust</code>)</p>
</div>
<div id="transitional-gate" class="section level3">
<h3 class="hasAnchor">
<a href="#transitional-gate" class="anchor"></a><code>Transitional gate</code>
</h3>
<p><code>flowClust.2d</code> can optionally construct a <code>Transitional gate</code>, which is a speical kind of polygon gate with one edge placed diagonally that is often seen in <code>flowJo</code>. Here is an example:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"CD19andCD20"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CD38"</span>, <span class="st">"CD24"</span>)
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.flowClust.2d</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">K</span><span class="kw">=</span><span class="fl">6</span>,<span class="kw">transitional</span><span class="kw">=</span><span class="fl">TRUE</span>,<span class="kw">target</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.5e3</span>,<span class="fl">3.5e3</span>), <span class="kw">quantile</span><span class="kw">=</span><span class="fl">0.95</span>,<span class="kw">translation</span><span class="kw">=</span><span class="fl">0.15</span>, <span class="kw">pp_res</span> <span class="kw">=</span> <span class="kw">NULL</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">chnl</span>[<span class="fl">2</span>]) + <span class="no">mylimits</span>
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-12-1.png" width="288"></p>
<p>The rational behind the algorithm is beyond the scope of this document. Please see its detailed explainations in <code><a href="../reference/gate_flowclust_2d.html">?flowClust.2d</a></code>.</p>
</div>
<div id="quadgate-tmix" class="section level3">
<h3 class="hasAnchor">
<a href="#quadgate-tmix" class="anchor"></a><code>quadGate.tmix</code>
</h3>
<p>This gating method identifies two quadrants (first, and third quadrants) by fitting the data with tmixture model. It is particually useful when the two markers are not well resolved thus the regular quadGate method that is based on <code>1d</code> gating will not find the perfect cut points on both dimensions.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/save_gs.html">load_gs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/gs_DC_auto"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"flowWorkspaceData"</span>))
<span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html">gh_pop_get_data</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">2</span>]], <span class="st">"HLADR+"</span>)
<span class="no">chnl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CD11c"</span>, <span class="st">"CD123"</span>)
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">fr</span>, <span class="no">chnl</span>[<span class="fl">1</span>], <span class="no">chnl</span>[<span class="fl">2</span>])
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">openCyto</span><span class="kw ns">:::</span><span class="fu">.quadGate.tmix</span>(<span class="no">fr</span>, <span class="kw">channels</span> <span class="kw">=</span> <span class="no">chnl</span>, <span class="kw">K</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">usePrior</span> <span class="kw">=</span> <span class="st">"no"</span>)
<span class="no">p</span> + <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html">geom_gate</a></span>(<span class="no">g</span>)</pre></body></html></div>
<p><img src="HowToAutoGating_files/figure-html/unnamed-chunk-13-1.png" width="288"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mike Jiang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
